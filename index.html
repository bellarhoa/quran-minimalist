<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adzan & Al-Qur'an</title>
    <link rel="stylesheet" href="/JavascriptAPI/stylesheet.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">
</head>

<body>
    <div class="date-wrapper">
        <div class="container">
            <h2 id="date-today"></h2>
        </div>
    </div>
    <div class="adzan-wrapper">
        <div class="container">
            <h4 id="city" class="city"></h4>
            <div class="adzan-list">
                <div class="adzan-item subuh">
                    <h4>Subuh</h4>
                    <h1 id="subuh">00.00</h1>
                </div>
                <div class="adzan-item dzuhur">
                    <h4>Dzuhur</h4>
                    <h1 id="dzuhur">00.00</h1>
                </div>
                <div class="adzan-item ashar">
                    <h4>Ashar</h4>
                    <h1 id="ashar">00.00</h1>
                </div>
                <div class="adzan-item maghrib">
                    <h4>Maghrib</h4>
                    <h1 id="maghrib">00.00</h1>
                </div>
                <div class="adzan-item isya">
                    <h4>Isya</h4>
                    <h1 id="isya">00.00</h1>
                </div>
            </div>
        </div>
    </div>

    <div class="quran-wrapper">
        <div class="container">
            <h2>Al Qur'an</h2>
            <div class="quran-list" id="quran-list">
            </div>
        </div>
    </div>

    <div id="modal-city" class="modal">
        <div class="modal-content">
            <span class="close" id="close-city">&times;</span>
            <label for="city-form">Pilih Kota/Kabupaten:</label>
            <select name="city-form" id="city-form">
            </select>
        </div>
    </div>

    <div id="modal-surah" class="modal">
        <div class="modal-content">
            <span class="close" id="close-surah">&times;</span>
            <div class="surah" id="surah">
                <!-- <h2 class="text-center">Al-Fatihah</h2>
                <h4 class="text-center">7 Ayat</h4>
                <br>
                <div class="ayat d-flex">
                    <h4 class="ayat-number">1</h4>
                    <div class="d-block">
                        <h5 class="ayat-ar">Ayat Arab</h5>
                        <h5 class="ayat-tr text-weight-normal">Ayat baca</h5>
                        <h5 class="ayat-id">Pengertian</h5>
                    </div>
                </div> -->
            </div>
        </div>
    </div>

    <script>
        var date = new Date();
        var tahun = date.getFullYear();
        var bulan = date.getMonth();
        var tanggal = date.getDate();
        var hari = date.getDay();
        var newBulan = null;

        getAdzan();
        function getAdzan(idCity) {
            if (idCity == null) {
                getAdzan(1301);
            }
            fetch("https://api.myquran.com/v1/sholat/jadwal/" + idCity + "/" + tahun + "/" + bulan + "/" + tanggal)
                .then(response => response.json())
                .then(data => {
                    var item = data.data;
                    if (item.lokasi != null) {
                        var dataKota = item.lokasi + ", " + item.daerah + ", Indonesia";
                    }
                    document.getElementById("city").innerHTML = dataKota.toLowerCase();
                    var jadwal = item.jadwal;
                    document.getElementById("subuh").innerHTML = jadwal.subuh;
                    document.getElementById("dzuhur").innerHTML = jadwal.dzuhur;
                    document.getElementById("ashar").innerHTML = jadwal.ashar;
                    document.getElementById("maghrib").innerHTML = jadwal.maghrib;
                    document.getElementById("isya").innerHTML = jadwal.isya;
                }).catch(e => {
                    console.log("Error Fetch Adzan: " + e);
                })
        }

        var cityForm = document.getElementById("city-form");
        cityForm.addEventListener("change", updateValue);
        function updateValue() {
            console.log(cityForm.value);
            getAdzan(cityForm.value);
        }

        switch (hari) {
            case 0: hari = "Minggu"; break;
            case 1: hari = "Senin"; break;
            case 2: hari = "Selasa"; break;
            case 3: hari = "Rabu"; break;
            case 4: hari = "Kamis"; break;
            case 5: hari = "Jum'at"; break;
            case 6: hari = "Sabtu"; break;
        }
        switch (bulan) {
            case 0: newBulan = "Januari"; break;
            case 1: newBulan = "Februari"; break;
            case 2: newBulan = "Maret"; break;
            case 3: newBulan = "April"; break;
            case 4: newBulan = "Mei"; break;
            case 5: newBulan = "Juni"; break;
            case 6: newBulan = "Juli"; break;
            case 7: newBulan = "Agustus"; break;
            case 8: newBulan = "September"; break;
            case 9: newBulan = "Oktober"; break;
            case 10: newBulan = "November"; break;
            case 11: newBulan = "Desember"; break;
        }
        var tampilTanggal = hari + ", " + tanggal + " " + newBulan + " " + tahun;
        document.getElementById("date-today").innerHTML = tampilTanggal;

        var modalCity = document.getElementById("modal-city");
        var btnCity = document.getElementById("city");
        var spanCity = document.getElementById("close-city");

        btnCity.onclick = function () {
            fetch("https://api.myquran.com/v1/sholat/kota/semua")
                .then(response => response.json())
                .then(data => {
                    var item = "";
                    for (var i = 0; i < data.length; i++) {
                        if (data[i].lokasi != null) {
                            item += `<option value="` + data[i].id + `">` + data[i].lokasi + `</option>`;
                        }
                    }
                    cityForm.innerHTML = item;
                }).catch(e => {
                    console.log("Error Fetch All City for Adzan: " + e);
                })
            modalCity.style.display = "block";
        }
        spanCity.onclick = function () {
            modalCity.style.display = "none";
        }
        window.onclick = function (event) {
            if (event.target == modalCity) {
                modalCity.style.display = "none";
            }
        }

        var modal = document.getElementById("modal-surah");
        var span = document.getElementById("close-surah");

        span.onclick = function () {
            modal.style.display = "none";
        }
        window.onclick = function (event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        fetch("https://al-quran-8d642.firebaseio.com/data.json?print=pretty")
            .then(response => response.json())
            .then(data => {
                var item = "";
                for (var i = 0; i < data.length; i++) {
                    item += `<div class="quran-surah" data-id="` + data[i].nomor + `">
                    <h4 class="surah-number">`+ data[i].nomor + `</h4>
                    <h5 class="surah-name">`+ data[i].nama + `</h5>
                    <h5 class="surah-define">`+ data[i].arti + `</h5>
                </div>`;
                }
                document.getElementById("quran-list").innerHTML = item;
                var cards = document.querySelectorAll(".quran-surah");
                for (var j = 0; j < cards.length; j++) {
                    var card = cards[j];
                    card.onclick = function () {
                        fetch("https://al-quran-8d642.firebaseio.com/surat/" + this.getAttribute("data-id") + ".json?print=pretty")
                            .then(response => response.json())
                            .then(ayat => {
                                var element = "";
                                element = `<h2 class="text-center">` + data[this.getAttribute("data-id") - 1].nama + `</h2>
                <h4 class="text-center">`+ data[this.getAttribute("data-id") - 1].ayat + ` Ayat</h4>
                <br>`
                                for (var k = 0; k < ayat.length; k++) {
                                    element +=
                                        `<div class="ayat d-flex">
                    <h4 class="ayat-number">`+ ayat[k].nomor + `</h4>
                    <div class="d-block">
                        <h1 class="ayat-ar">`+ ayat[k].ar + `</h1>
                        <h5 class="ayat-tr text-weight-normal">`+ ayat[k].tr + `</h5>
                        <h5 class="ayat-id">`+ ayat[k].id + `</h5>
                    </div>
                </div>`;
                                }
                                document.getElementById("surah").innerHTML = element;
                            }).catch(e => {
                                console.log("Error Fetch Ayat: " + e);
                            })
                        modal.style.display = "block";
                    };
                }
            }).catch(e => {
                console.log("Error Fetch Quran: " + e);
            })
    </script>
</body>

</html>